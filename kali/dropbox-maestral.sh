#!/usr/bin/env bash

set -e

APP_HOME="${HOME}/Applications"

if [[ ! -f "${APP_HOME}/maestral/bin/activate" ]]; then
    mkdir -p "${APP_HOME}"
    virtualenv "${APP_HOME}/maestral"
    source "${APP_HOME}/maestral/bin/activate"
    if [[ -n "${DISPLAY}" ]]; then
      python3 -m pip install --upgrade 'maestral[gui]'
    else
      python3 -m pip install --upgrade 'maestral'
    fi
fi

source "${APP_HOME}/maestral/bin/activate"
exec maestral "$@"
