#!/usr/bin/env bash

set -e
export DEBIAN_FRONTEND=noninteractive

if true || [ "$(host_arch.sh)" == "arm64" ]; then
    # use open source client: https://github.com/samschott/maestral
    [ -e "/usr/local/bin/dropbox" ] && exit 0
    sudo apt-get install -y libxcb-cursor0
    sudo cp /vagrant/dropbox-maestral.sh /usr/local/bin/dropbox
    sudo chmod +x /usr/local/bin/dropbox
else
    [ -e "${HOME}/.dropbox-dist/dropboxd" ] && exit 0
    URL="https://www.dropbox.com/download?plat=lnx.x86_64"
    curl -L "${URL}" | tar -xzf - -C "${HOME}"
    sudo curl -L -o /usr/local/bin/dropbox https://www.dropbox.com/download?dl=packages/dropbox.py
    sudo chmod +x /usr/local/bin/dropbox
fi
