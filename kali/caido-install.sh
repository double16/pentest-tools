#!/usr/bin/env bash

set -e
export DEBIAN_FRONTEND=noninteractive

CAIDO_VER=0.41.0
if [ "$(host_arch.sh)" == "arm64" ]; then
  CAIDO_CLI_PKG="https://storage.googleapis.com/caido-releases/v${CAIDO_VER}/caido-cli-v${CAIDO_VER}-linux-aarch64.tar.gz"
else
  CAIDO_PKG="https://storage.googleapis.com/caido-releases/v${CAIDO_VER}/caido-desktop-v${CAIDO_VER}-linux-x86_64.AppImage"
  CAIDO_CLI_PKG="https://storage.googleapis.com/caido-releases/v${CAIDO_VER}/caido-cli-v${CAIDO_VER}-linux-x86_64.tar.gz"
fi
if [[ -n "${CAIDO_PKG}" ]]; then
    if [[ ! -f "${HOME}/Desktop/Caido.AppImage" ]]; then
      curl --fail -o "${HOME}/Desktop/Caido.AppImage" -L "${CAIDO_PKG}"
      chmod +x "${HOME}/Desktop/Caido.AppImage"
    fi
fi
if [[ -n "${CAIDO_CLI_PKG}" ]]; then
    if [[ ! -f /usr/local/bin/caido-cli ]]; then
      curl --fail -o /tmp/caido-cli.tar.gz -L "${CAIDO_CLI_PKG}"
      sudo tar -xz -C /usr/local/bin -f /tmp/caido-cli.tar.gz
      sudo chmod +x /usr/local/bin/caido-cli
      rm /tmp/caido-cli.tar.gz
    fi
fi
