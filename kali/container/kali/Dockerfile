FROM kalilinux/kali-rolling AS gobuild

RUN apt-get update &&\
    apt-get install -y curl golang-go

RUN go install github.com/projectdiscovery/katana/cmd/katana@latest
RUN GO111MODULE=on go install github.com/jaeles-project/gospider@latest

FROM kalilinux/kali-rolling

ENV DEBIAN_FRONTEND=noninteractive

# base usability tools
RUN apt-get update &&\
    apt-get install -y curl gnupg zsh zsh-autosuggestions zsh-syntax-highlighting procps psmisc iputils-ping vim neovim nano less

# wordlists
RUN apt-get update &&\
    apt-get install -y \
    seclists payloadsallthethings

#RUN curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
#      chmod 755 msfinstall && \
#      ./msfinstall

# tools
RUN apt-get update &&\
    apt-get install -y --install-recommends \
    kali-tools-fuzzing kali-tools-crypto-stego kali-tools-database kali-tools-exploitation kali-tools-identify \
    kali-tools-information-gathering kali-tools-passwords kali-tools-post-exploitation kali-tools-vulnerability kali-tools-web kali-tools-windows-resources \
    nmap gobuster hakrawler xxd file nikto wpscan joomscan nuclei whatweb hydra xsser python3-selenium feroxbuster \
    transmission-cli

# compiled tools
COPY --from=gobuild /root/go/bin/katana /usr/local/bin
COPY --from=gobuild /root/go/bin/gospider /usr/local/bin

ADD https://github.com/double16/shadycompass/releases/download/latest/shadycompass_main_linux_amd64 /usr/local/bin/shadycompass
RUN chmod 0755 /usr/local/bin/shadycompass

ADD entrypoint.sh /entrypoint.sh

CMD ["/entrypoint.sh"]
