#!/bin/bash

TARGET_UID="$(stat --printf=%u /data)"
TARGET_GID="$(stat --printf=%g /data)"

grep -q ":${TARGET_GID}:" /etc/group || adduser --quiet --group --gid "${TARGET_GID}" kali
grep -q ":${TARGET_UID}:" /etc/passwd || adduser --quiet --uid "${TARGET_UID}" --gid "${TARGET_GID}" --shell /usr/bin/zsh --disabled-password kali

TARGET_USER="$(id -un -- ${TARGET_UID})"

if [[ -n "${TARGET_USER}" ]]; then
  exec su "${TARGET_USER}" -c "while true; do sleep 3600; done"
else
  while true; do sleep 3600; done
fi
