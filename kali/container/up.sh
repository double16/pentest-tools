#!/usr/bin/env bash

if command -v docker-compose; then
  COMPOSE="docker-compose"
else
  COMPOSE="docker compose"
fi

if [[ -n "$1" ]]; then
  export DATA_DIR="$1"
fi

if [[ -z "${DATA_DIR}" ]]; then
  for MOUNT in ${HOME}/Dropbox ${HOME}/Library/CloudStorage/Dropbox $(mount | cut -d " " -f 3); do
    if [ -d "${MOUNT}/Assessments" ]; then
      export DATA_DIR="${MOUNT}/Assessments"
      COMPOSE_FILES="docker-compose.data.yml"
      break
    fi
  done
fi

${COMPOSE} -p kali ${COMPOSE_FILES:+ -f docker-compose.yml -f ${COMPOSE_FILES}} ${@:-up -d}
